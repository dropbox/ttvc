<head>
  <!-- Deliberately do NOT include /dist/index.min.js here. Instead we append it after the window 'load' event to reproduce the failure mode -->
  <script>
    // after the real window 'load' fires, append TTVC and analytics, then add a delayed image
    window.addEventListener('load', function () {
      // small delay so load has definitely finished
      setTimeout(() => {
        const analytics = document.createElement('script');
        analytics.src = '/analytics.js';
        // when analytics is ready, add a resource that should be tracked
        analytics.onload = () => {
          // add an image that loads with a delay so it would normally be observed
          console.log('Analytics script loaded');
          const img = document.createElement('img');
          img.src = '/150.png?delay=500';
          document.body.appendChild(img);
        };

        const ttvc = document.createElement('script');
        ttvc.src = '/dist/index.min.js';
        document.head.appendChild(ttvc);
        ttvc.onload = () => {
          console.log('TTVC script loaded');
          document.head.appendChild(analytics);
        };
      }, 50);
    });
  </script>
</head>

<body>
  <h1>late load test</h1>
</body>
